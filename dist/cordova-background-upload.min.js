!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cordova-background-upload",[],t):"object"==typeof exports?exports["cordova-background-upload"]=t():e["cordova-background-upload"]=t()}(this,function(){return function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){e.exports=r(11)},function(e,t){function r(e){return null!==e&&"object"==typeof e}e.exports=r},function(e,t,r){function i(e){if(e)return n(e)}function n(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}e.exports=i,i.prototype.on=i.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},i.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i,n=0;n<r.length;n++)if(i=r[n],i===t||i.fn===t){r.splice(n,1);break}return this},i.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r){r=r.slice(0);for(var i=0,n=r.length;i<n;++i)r[i].apply(this,t)}return this},i.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},i.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function n(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!n(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,n,a,u,h;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(r=this._events[e],o(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),r.apply(this,a)}else if(s(r))for(a=Array.prototype.slice.call(arguments,1),h=r.slice(),n=h.length,u=0;u<n;u++)h[u].apply(this,a);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(n=o(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var r,n,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],o=r.length,n=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(r)){for(a=o;a-- >0;)if(r[a]===t||r[a].listener&&r[a].listener===t){n=a;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],i(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=r(3),h=i(u),l={active:!0,rate:40,ratePer:4e4,concurrent:20},c=function(e){function t(e){n(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._options({_requestTimes:[0],_current:0,_buffer:[],_serials:{},_timeout:!1}),r._options(l),r._options(e),r}return o(t,e),a(t,[{key:"_options",value:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}},{key:"options",value:function(e,t){"string"==typeof e&&t&&(e={options:t}),this._options(e),this.cycle()}},{key:"next",value:function(){var e=this;if(e._requestTimes=e._requestTimes.slice(e.rate*-1),!e.active||e._current>=e.concurrent||e._isRateBound()||!e._buffer.length)return!1;var t=e._buffer.findIndex(function(t){return!t.serial||!e._serials[t.serial]});return t===-1?(e._isSerialBound=!0,!1):(e.send(e._buffer.splice(t,1)[0]),!0)}},{key:"serial",value:function(e,t){var r=this._serials,i=this;if(e.serial!==!1){if(void 0===t)return r[e.serial];t===!1&&(i._isSerialBound=!1),r[e.serial]=t}}},{key:"_isRateBound",value:function(){var e=this;return Date.now()-e._requestTimes[0]<e.ratePer&&e._buffer.length>0}},{key:"cycle",value:function(e){var t=this;for(e&&t._buffer.push(e),clearTimeout(t._timeout);t.next(););if(t._isRateBound()){var r=void 0;r=t.ratePer,r-=Date.now()-t._requestTimes[0],r+=1,t._timeout=setTimeout(function(){t.cycle()},r)}}},{key:"send",value:function(e){function t(t,i){r._current-=1,t&&h.default.listenerCount(r,"error")&&r.emit("error",i),r.emit("received",e),r._buffer.length||r._current||r.emit("drained"),r.serial(e,!1),r.cycle(),e._maskedCallback(t,i)}var r=this;r.serial(e,!0),e._maskedEnd(t),r._requestTimes.push(Date.now()),r._current+=1,this.emit("sent",e)}},{key:"plugin",value:function(e){var t=this;return function(r){return r.throttle=t,r.serial=e||!1,r._maskedEnd=r.end,r.end=function(e){return r._maskedCallback=e||function(){},r.throttle.cycle(r),r},r}}}]),t}(h.default);e.exports=c},function(e,t,r){function i(){}function n(e){if(!y(e))return e;var t=[];for(var r in e)s(t,r,e[r]);return t.join("&")}function s(e,t,r){if(null!=r)if(Array.isArray(r))r.forEach(function(r){s(e,t,r)});else if(y(r))for(var i in r)s(e,t+"["+i+"]",r[i]);else e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));else null===r&&e.push(encodeURIComponent(t))}function o(e){for(var t,r,i={},n=e.split("&"),s=0,o=n.length;s<o;++s)t=n[s],r=t.indexOf("="),r==-1?i[decodeURIComponent(t)]="":i[decodeURIComponent(t.slice(0,r))]=decodeURIComponent(t.slice(r+1));return i}function a(e){var t,r,i,n,s=e.split(/\r?\n/),o={};s.pop();for(var a=0,u=s.length;a<u;++a)r=s[a],t=r.indexOf(":"),i=r.slice(0,t).toLowerCase(),n=g(r.slice(t+1)),o[i]=n;return o}function u(e){return/[\/+]json\b/.test(e)}function h(e){this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"==typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var t=this.xhr.status;1223===t&&(t=204),this._setStatusProperties(t),this.header=this.headers=a(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&e._responseType?this.body=this.xhr.response:this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function l(e,t){var r=this;this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on("end",function(){var e=null,t=null;try{t=new h(r)}catch(t){return e=new Error("Parser is unable to parse the response"),e.parse=!0,e.original=t,r.xhr?(e.rawResponse="undefined"==typeof r.xhr.responseType?r.xhr.responseText:r.xhr.response,e.status=r.xhr.status?r.xhr.status:null,e.statusCode=e.status):(e.rawResponse=null,e.status=null),r.callback(e)}r.emit("response",t);var i;try{r._isResponseOK(t)||(i=new Error(t.statusText||"Unsuccessful HTTP response"),i.original=e,i.response=t,i.status=t.status)}catch(e){i=e}i?r.callback(i,t):r.callback(null,t)})}function c(e,t,r){var i=b("DELETE",e);return"function"==typeof t&&(r=t,t=null),t&&i.send(t),r&&i.end(r),i}var p;"undefined"!=typeof window?p=window:"undefined"!=typeof self?p=self:(console.warn("Using browser-only version of superagent in non-browser environment"),p=this);var f=r(2),d=r(7),y=r(1),v=r(6),_=r(8),m=r(9),b=t=e.exports=function(e,r){return"function"==typeof r?new t.Request("GET",e).end(r):1==arguments.length?new t.Request("GET",e):new t.Request(e,r)};t.Request=l,b.getXHR=function(){if(!(!p.XMLHttpRequest||p.location&&"file:"==p.location.protocol&&p.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}throw Error("Browser-only verison of superagent could not find XHR")};var g="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};b.serializeObject=n,b.parseString=o,b.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},b.serialize={"application/x-www-form-urlencoded":n,"application/json":JSON.stringify},b.parse={"application/x-www-form-urlencoded":o,"application/json":JSON.parse},_(h.prototype),h.prototype._parseBody=function(e){var t=b.parse[this.type];return this.req._parser?this.req._parser(this,e):(!t&&u(this.type)&&(t=b.parse["application/json"]),t&&e&&(e.length||e instanceof Object)?t(e):null)},h.prototype.toError=function(){var e=this.req,t=e.method,r=e.url,i="cannot "+t+" "+r+" ("+this.status+")",n=new Error(i);return n.status=this.status,n.method=t,n.url=r,n},b.Response=h,f(l.prototype),d(l.prototype),l.prototype.type=function(e){return this.set("Content-Type",b.types[e]||e),this},l.prototype.accept=function(e){return this.set("Accept",b.types[e]||e),this},l.prototype.auth=function(e,t,r){switch("object"==typeof t&&null!==t&&(r=t),r||(r={type:"function"==typeof btoa?"basic":"auto"}),r.type){case"basic":this.set("Authorization","Basic "+btoa(e+":"+t));break;case"auto":this.username=e,this.password=t;break;case"bearer":this.set("Authorization","Bearer "+e)}return this},l.prototype.query=function(e){return"string"!=typeof e&&(e=n(e)),e&&this._query.push(e),this},l.prototype.attach=function(e,t,r){if(t){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(e,t,r||t.name)}return this},l.prototype._getFormData=function(){return this._formData||(this._formData=new p.FormData),this._formData},l.prototype.callback=function(e,t){if(this._maxRetries&&this._retries++<this._maxRetries&&m(e,t))return this._retry();var r=this._callback;this.clearTimeout(),e&&(this._maxRetries&&(e.retries=this._retries-1),this.emit("error",e)),r(e,t)},l.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},l.prototype.buffer=l.prototype.ca=l.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},l.prototype.pipe=l.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},l.prototype._appendQueryString=function(){var e=this._query.join("&");if(e&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+e),this._sort){var t=this.url.indexOf("?");if(t>=0){var r=this.url.substring(t+1).split("&");v(this._sort)?r.sort(this._sort):r.sort(),this.url=this.url.substring(0,t)+"?"+r.join("&")}}},l.prototype._isHost=function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&"[object Object]"!==Object.prototype.toString.call(e)},l.prototype.end=function(e){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=e||i,this._appendQueryString(),this._end()},l.prototype._end=function(){var e=this,t=this.xhr=b.getXHR(),r=this._formData||this._data;this._setTimeouts(),t.onreadystatechange=function(){var r=t.readyState;if(r>=2&&e._responseTimeoutTimer&&clearTimeout(e._responseTimeoutTimer),4==r){var i;try{i=t.status}catch(e){i=0}if(!i){if(e.timedout||e._aborted)return;return e.crossDomainError()}e.emit("end")}};var i=function(t,r){r.total>0&&(r.percent=r.loaded/r.total*100),r.direction=t,e.emit("progress",r)};if(this.hasListeners("progress"))try{t.onprogress=i.bind(null,"download"),t.upload&&(t.upload.onprogress=i.bind(null,"upload"))}catch(e){}try{this.username&&this.password?t.open(this.method,this.url,!0,this.username,this.password):t.open(this.method,this.url,!0)}catch(e){return this.callback(e)}if(this._withCredentials&&(t.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof r&&!this._isHost(r)){var n=this._header["content-type"],s=this._serializer||b.serialize[n?n.split(";")[0]:""];!s&&u(n)&&(s=b.serialize["application/json"]),s&&(r=s(r))}for(var o in this.header)null!=this.header[o]&&this.header.hasOwnProperty(o)&&t.setRequestHeader(o,this.header[o]);return this._responseType&&(t.responseType=this._responseType),this.emit("request",this),t.send("undefined"!=typeof r?r:null),this},b.get=function(e,t,r){var i=b("GET",e);return"function"==typeof t&&(r=t,t=null),t&&i.query(t),r&&i.end(r),i},b.head=function(e,t,r){var i=b("HEAD",e);return"function"==typeof t&&(r=t,t=null),t&&i.send(t),r&&i.end(r),i},b.options=function(e,t,r){var i=b("OPTIONS",e);return"function"==typeof t&&(r=t,t=null),t&&i.send(t),r&&i.end(r),i},b.del=c,b.delete=c,b.patch=function(e,t,r){var i=b("PATCH",e);return"function"==typeof t&&(r=t,t=null),t&&i.send(t),r&&i.end(r),i},b.post=function(e,t,r){var i=b("POST",e);return"function"==typeof t&&(r=t,t=null),t&&i.send(t),r&&i.end(r),i},b.put=function(e,t,r){var i=b("PUT",e);return"function"==typeof t&&(r=t,t=null),t&&i.send(t),r&&i.end(r),i}},function(e,t,r){function i(e){var t=n(e)?Object.prototype.toString.call(e):"";return"[object Function]"===t}var n=r(1);e.exports=i},function(e,t,r){function i(e){if(e)return n(e)}function n(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}var s=r(1);e.exports=i,i.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},i.prototype.parse=function(e){return this._parser=e,this},i.prototype.responseType=function(e){return this._responseType=e,this},i.prototype.serialize=function(e){return this._serializer=e,this},i.prototype.timeout=function(e){if(!e||"object"!=typeof e)return this._timeout=e,this._responseTimeout=0,this;for(var t in e)switch(t){case"deadline":this._timeout=e.deadline;break;case"response":this._responseTimeout=e.response;break;default:console.warn("Unknown timeout option",t)}return this},i.prototype.retry=function(e){return 0!==arguments.length&&e!==!0||(e=1),e<=0&&(e=0),this._maxRetries=e,this._retries=0,this},i.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},i.prototype.then=function(e,t){if(!this._fullfilledPromise){var r=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise(function(e,t){r.end(function(r,i){r?t(r):e(i)})})}return this._fullfilledPromise.then(e,t)},i.prototype.catch=function(e){return this.then(void 0,e)},i.prototype.use=function(e){return e(this),this},i.prototype.ok=function(e){if("function"!=typeof e)throw Error("Callback required");return this._okCallback=e,this},i.prototype._isResponseOK=function(e){return!!e&&(this._okCallback?this._okCallback(e):e.status>=200&&e.status<300)},i.prototype.get=function(e){return this._header[e.toLowerCase()]},i.prototype.getHeader=i.prototype.get,i.prototype.set=function(e,t){if(s(e)){for(var r in e)this.set(r,e[r]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},i.prototype.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},i.prototype.field=function(e,t){if(null===e||void 0===e)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),s(e)){for(var r in e)this.field(r,e[r]);return this}if(Array.isArray(t)){for(var i in t)this.field(e,t[i]);return this}if(null===t||void 0===t)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof t&&(t=""+t),this._getFormData().append(e,t),this},i.prototype.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},i.prototype.withCredentials=function(e){return void 0==e&&(e=!0),this._withCredentials=e,this},i.prototype.redirects=function(e){return this._maxRedirects=e,this},i.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},i.prototype.send=function(e){var t=s(e),r=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),t&&!this._data)Array.isArray(e)?this._data=[]:this._isHost(e)||(this._data={});else if(e&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(t&&s(this._data))for(var i in e)this._data[i]=e[i];else"string"==typeof e?(r||this.type("form"),r=this._header["content-type"],"application/x-www-form-urlencoded"==r?this._data=this._data?this._data+"&"+e:e:this._data=(this._data||"")+e):this._data=e;return!t||this._isHost(e)?this:(r||this.type("json"),this)},i.prototype.sortQuery=function(e){return this._sort="undefined"==typeof e||e,this},i.prototype._timeoutError=function(e,t,r){if(!this._aborted){var i=new Error(e+t+"ms exceeded");i.timeout=t,i.code="ECONNABORTED",i.errno=r,this.timedout=!0,this.abort(),this.callback(i)}},i.prototype._setTimeouts=function(){var e=this;this._timeout&&!this._timer&&(this._timer=setTimeout(function(){e._timeoutError("Timeout of ",e._timeout,"ETIME")},this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout(function(){e._timeoutError("Response timeout of ",e._responseTimeout,"ETIMEDOUT")},this._responseTimeout))}},function(e,t,r){function i(e){if(e)return n(e)}function n(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}var s=r(10);e.exports=i,i.prototype.get=function(e){return this.header[e.toLowerCase()]},i.prototype._setHeaderProperties=function(e){var t=e["content-type"]||"";this.type=s.type(t);var r=s.params(t);for(var i in r)this[i]=r[i];this.links={};try{e.link&&(this.links=s.parseLinks(e.link))}catch(e){}},i.prototype._setStatusProperties=function(e){var t=e/100|0;this.status=this.statusCode=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.redirect=3==t,this.clientError=4==t,this.serverError=5==t,this.error=(4==t||5==t)&&this.toError(),this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.forbidden=403==e,this.notFound=404==e}},function(e,t){var r=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];e.exports=function(e,t){return!!(e&&e.code&&~r.indexOf(e.code)||t&&t.status&&t.status>=500||e&&"timeout"in e&&"ECONNABORTED"==e.code||e&&"crossDomain"in e)}},function(e,t){t.type=function(e){return e.split(/ *; */).shift()},t.params=function(e){return e.split(/ *; */).reduce(function(e,t){var r=t.split(/ *= */),i=r.shift(),n=r.shift();return i&&n&&(e[i]=n),e},{})},t.parseLinks=function(e){return e.split(/ *, */).reduce(function(e,t){var r=t.split(/ *; */),i=r[0].slice(1,-1),n=r[1].split(/ *= */)[1].slice(1,-1);return e[n]=i,e},{})},t.cleanHeader=function(e,t){return delete e["content-type"],delete e["content-length"],delete e["transfer-encoding"],delete e.host,t&&delete e.cookie,e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(5),n=r(4),s=function(){function e(){this.nativeUploader=null,this._handlers=[]}return e.prototype.init=function(e){this._handlers={progress:[],success:[],error:[]};var t=this;return window.cordova?(this.nativeUploader=FileTransferManager.init(e),this.nativeUploader.on("success",function(e){t.emit("success",e)}),this.nativeUploader.on("progress",function(e){t.emit("progress",e)}),this.nativeUploader.on("error",function(e){t.emit("error",e)})):this.throttleConfig=new n({concurrent:1}),this},e.prototype.upload=function(e){try{var t=this;if(!e)return void t.emit("error",{error:"upload settings object is missing or invalid argument"});if(!e.serverUrl)return void t.emit("error",{error:"server url is required"});if(e.headers||(e.headers={}),""==e.serverUrl.trim()&&t.emit("error",{error:"invalid server url"}),window.cordova){var r=e.file;if(r){if("undefined"==typeof FileTransferManager)return console.log("cordova-plugin-background-upload not found..fallback to superagent..uploads will happen only in foreground"),this.uploadViaSuperAgent(e);if(cordova.file||t.emit("error",{error:"cordova-plugin-file not found..install it via: cordova plugin add cordova-plugin-file --save"}),"android"==cordova.platformId.toLowerCase()){cordova.plugins.permissions||t.emit("error",{error:"cordova-plugin-android-permissions not found..install it via: cordova plugin add cordova-plugin-android-permissions --save"});var i=cordova.plugins.permissions;i.requestPermission(i.WRITE_EXTERNAL_STORAGE,function(i){i.hasPermission?t.uploadNatively(e,r):t.emit("error",{error:"file system permission denied"})},function(){t.emit("error",{error:"file system permission denied"})})}else this.uploadNatively(e,r)}else e.filePath||t.emit("error",{error:"filePath parameter is required"}),""==e.filePath&&t.emit("error",{error:"invalid filePath"}),"undefined"==typeof FileTransferManager&&t.emit("error",{error:"cordova-plugin-background-upload not found.."}),this.nativeUploader.startUpload(e)}else{if(!e.file)return void t.emit("error","file parameter is required");this.uploadViaSuperAgent(e)}}catch(e){this.emit("error",{error:e})}},e.prototype.uploadNatively=function(e,t){var r=cordova.file.externalCacheDirectory||cordova.file.cacheDirectory,i=this;window.resolveLocalFileSystemURL(r,function(r){var n=Math.floor(Date.now())+"_"+t.name.replace(/ /g,"_").replace(/%20/g,"");r.getFile(n,{create:!0},function(r){r.createWriter(function(n){var s=!1;n.onwriteend=function(t){s||(e.filePath=r.nativeURL.replace("file://",""),delete e.file,i.nativeUploader.startUpload(e))},n.onerror=function(e){s=!0,console.error(e),i.emit("error",{error:"error writing file to disk"})},n.write(t)},function(e){console.error(e),i.emit("error",{error:"error writing file to disk for upload"})})})})},e.prototype.uploadViaSuperAgent=function(e){var t=this;i.post(e.serverUrl).use(this.throttleConfig.plugin()).set(null!=e.headers?e.headers:{}).field(null!=e.parameters?e.parameters:{}).on("progress",function(r){null!=r.percent&&void 0!=r.percent&&r.percent>=0&&t.emit("progress",{id:e.id,state:"UPLOADING",progress:Math.round(10*r.percent)/10})}).attach("file",e.file).end(function(r,i){null!=r?t.emit("error",{id:e.id,state:"FAILED",error:r}):t.emit("success",{id:e.id,state:"UPLOADED",serverResponse:JSON.stringify(i.body)})})},e.prototype.on=function(e,t){this._handlers.hasOwnProperty(e)||(this._handlers[e]=[]),this._handlers[e].push(t)},e.prototype.off=function(e,t){if(this._handlers.hasOwnProperty(e)){var r=this._handlers[e].indexOf(t);r>=0&&this._handlers[e].splice(r,1)}},e.prototype.emit=function(e,t){var r=Array.prototype.slice.call(arguments),e=r.shift();if(!this._handlers.hasOwnProperty(e))return!1;for(var i=0,n=this._handlers[e].length;i<n;i++){var s=this._handlers[e][i];"function"==typeof s?s.apply(void 0,r):console.log("event handler: "+e+" must be a function")}return!0},e}();t.BackgroundUpload=s}])});
//# sourceMappingURL=cordova-background-upload.min.js.map